<!--pages/rooms/rooms.wxml-->
<view class="container">
  <!-- çŠ¶æ€åˆ‡æ¢ -->
  <view class="status-tabs">
    <view 
      class="tab-item {{status === 'waiting' ? 'active' : ''}}"
      data-status="waiting"
      bindtap="onStatusChange"
    >
      ç­‰å¾…ä¸­
    </view>
    <view 
      class="tab-item {{status === 'playing' ? 'active' : ''}}"
      data-status="playing"
      bindtap="onStatusChange"
    >
      æ¸¸æˆä¸­
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-filter-bar">
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <input 
        class="search-input"
        type="text"
        placeholder="æœç´¢æˆ¿é—´åç§°ã€æˆ¿é—´å·ã€æˆ¿ä¸»"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
      />
      <view class="search-icon">ğŸ”</view>
      <view 
        class="clear-btn" 
        wx:if="{{searchKeyword}}"
        bindtap="onClearSearch"
      >
        âœ•
      </view>
    </view>
    
    <!-- ç­›é€‰æŒ‰é’® -->
    <view class="filter-btn" bindtap="onToggleFilter">
      <text>ç­›é€‰</text>
      <text class="filter-icon">â–¼</text>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilter}}">
    <view class="filter-title">æŒ‰äººæ•°ç­›é€‰</view>
    <view class="filter-options">
      <view 
        class="filter-option {{filterPlayerCount === null ? 'active' : ''}}"
        data-count="{{null}}"
        bindtap="onFilterPlayerCount"
      >
        å…¨éƒ¨
      </view>
      <view 
        class="filter-option {{filterPlayerCount === 2 ? 'active' : ''}}"
        data-count="2"
        bindtap="onFilterPlayerCount"
      >
        2äºº
      </view>
      <view 
        class="filter-option {{filterPlayerCount === 3 ? 'active' : ''}}"
        data-count="3"
        bindtap="onFilterPlayerCount"
      >
        3äºº
      </view>
      <view 
        class="filter-option {{filterPlayerCount === 4 ? 'active' : ''}}"
        data-count="4"
        bindtap="onFilterPlayerCount"
      >
        4äºº
      </view>
      <view 
        class="filter-option {{filterPlayerCount === 5 ? 'active' : ''}}"
        data-count="5"
        bindtap="onFilterPlayerCount"
      >
        5äºº
      </view>
      <view 
        class="filter-option {{filterPlayerCount === 6 ? 'active' : ''}}"
        data-count="6"
        bindtap="onFilterPlayerCount"
      >
        6äºº
      </view>
    </view>
    <view class="filter-actions">
      <button class="btn-clear" bindtap="onClearFilters">æ¸…é™¤ç­›é€‰</button>
    </view>
  </view>

  <!-- åˆ›å»ºæˆ¿é—´æŒ‰é’® -->
  <view class="create-room-btn" bindtap="onCreateRoom">
    <text class="icon">â•</text>
    <text>åˆ›å»ºæˆ¿é—´</text>
  </view>

  <!-- æˆ¿é—´åˆ—è¡¨ -->
  <view class="room-list">
    <block wx:if="{{loading && rooms.length === 0}}">
      <skeleton type="list" rows="3" />
    </block>
    
    <block wx:elif="{{rooms.length === 0}}">
      <view class="empty-state">
        <view class="empty-state-icon">ğŸ </view>
        <view class="empty-state-text">
          <text wx:if="{{searchKeyword || filterPlayerCount !== null}}">
            æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æˆ¿é—´
          </text>
          <text wx:else>æš‚æ— æˆ¿é—´</text>
        </view>
        <view class="empty-state-desc" wx:if="{{!searchKeyword && filterPlayerCount === null}}">
          ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»ºæˆ¿é—´å¼€å§‹æ¸¸æˆ
        </view>
      </view>
    </block>

    <block wx:else>
      <view 
        class="room-item fade-in"
        wx:for="{{rooms}}"
        wx:key="roomId"
        data-roomid="{{item.roomId}}"
        data-password="{{item.password}}"
        bindtap="onViewRoom"
      >
        <view class="room-header">
          <view class="room-name">{{item.roomName}}</view>
          <view class="room-status {{item.status}}">
            {{item.status === 'waiting' ? 'ç­‰å¾…ä¸­' : 'æ¸¸æˆä¸­'}}
          </view>
        </view>
        
        <view class="room-info">
          <view class="info-item">
            <text class="label">æˆ¿ä¸»:</text>
            <text class="value">{{item.ownerName}}</text>
          </view>
          <view class="info-item">
            <text class="label">äººæ•°:</text>
            <text class="value">{{item.players.length}}/{{item.settings.maxPlayers}}</text>
          </view>
          <view class="info-item">
            <text class="label">ç›²æ³¨:</text>
            <text class="value">{{item.settings.smallBlind}}/{{item.settings.bigBlind}}</text>
          </view>
        </view>

        <view class="room-footer">
          <view class="room-id">æˆ¿é—´å·: {{item.roomId}}</view>
          <view class="join-btn" catchtap="onJoinRoom" data-roomid="{{item.roomId}}" data-password="{{item.password}}">
            åŠ å…¥
          </view>
        </view>
      </view>
    </block>
  </view>
</view>
