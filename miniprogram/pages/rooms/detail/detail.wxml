<!--pages/rooms/detail/detail.wxml-->
<view class="container">
  <block wx:if="{{room}}">
    <!-- 房间信息 -->
    <view class="room-info-card">
      <view class="room-header">
        <view class="room-name">{{room.roomName}}</view>
        <view class="room-header-actions">
          <view class="room-status {{room.status}}">
            {{room.status === 'waiting' ? '等待中' : '游戏中'}}
          </view>
          <button 
            wx:if="{{isOwner && room.status === 'waiting'}}"
            class="edit-settings-btn"
            size="mini"
            bindtap="onShowSettingsEdit"
          >
            编辑设置
          </button>
        </view>
      </view>
      
      <view class="room-settings">
        <view class="setting-item">
          <text class="label">盲注:</text>
          <text class="value">{{room.settings.smallBlind}}/{{room.settings.bigBlind}}</text>
        </view>
        <view class="setting-item">
          <text class="label">初始筹码:</text>
          <text class="value">{{room.settings.initialChips}}</text>
        </view>
      <view class="setting-item">
        <text class="label">房间号:</text>
        <text class="value">{{room.roomId}}</text>
      </view>
      <view class="setting-item" wx:if="{{inviteCode}}">
        <text class="label">邀请码:</text>
        <text class="value invite-code">{{inviteCode}}</text>
        <button class="copy-btn" size="mini" bindtap="onCopyInviteCode">复制</button>
      </view>
    </view>
    <view class="invite-section" wx:if="{{isOwner || isInRoom}}">
      <button class="invite-btn" bindtap="onShowInvite">邀请好友</button>
    </view>
  </view>

    <!-- 玩家列表 -->
    <view class="players-card">
      <view class="card-title">玩家列表 ({{room.players.length}}/{{room.settings.maxPlayers}})</view>
      <view class="players-list">
        <view 
          class="player-item {{item.userId === userInfo.userId ? 'me' : ''}}"
          wx:for="{{room.players}}"
          wx:key="userId"
        >
          <view class="player-avatar">{{item.nickname.charAt(0)}}</view>
          <view class="player-info">
            <view class="player-name">
              {{item.nickname}}
              <text wx:if="{{item.userId === room.ownerId}}" class="owner-badge">房主</text>
            </view>
            <view class="player-chips">筹码: {{item.chips}}</view>
          </view>
          <view class="player-status">
            <view class="ready-status {{item.isReady ? 'ready' : 'not-ready'}}">
              {{item.isReady ? '已准备' : '未准备'}}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="actions" wx:if="{{isInRoom}}">
      <button 
        class="action-btn {{currentPlayerReady ? 'ready' : ''}}"
        bindtap="onToggleReady"
      >
        {{currentPlayerReady ? '取消准备' : '准备'}}
      </button>
      
      <button 
        wx:if="{{isOwner && room.status === 'waiting'}}"
        class="action-btn primary"
        bindtap="onStartGame"
        disabled="{{!allReady}}"
      >
        开始游戏
      </button>
      
      <button 
        class="action-btn danger"
        bindtap="onLeaveRoom"
      >
        离开房间
      </button>
    </view>

    <!-- 聊天区域 -->
    <view class="chat-card">
      <view class="card-title">聊天</view>
      <scroll-view class="chat-messages" scroll-y scroll-top="{{chatScrollTop}}">
        <view 
          class="chat-message"
          wx:for="{{chatMessages}}"
          wx:key="index"
        >
          <text class="chat-nickname">{{item.nickname}}:</text>
          <text class="chat-content">{{item.message}}</text>
        </view>
      </scroll-view>
      <view class="chat-input-area">
        <input 
          class="chat-input"
          type="text"
          placeholder="输入消息..."
          value="{{chatInput}}"
          bindinput="onChatInput"
        />
        <button class="chat-send-btn" bindtap="onSendChat">发送</button>
      </view>
    </view>

    <!-- 邀请对话框 -->
    <view class="invite-dialog {{showInviteDialog ? 'show' : ''}}" wx:if="{{showInviteDialog}}" bindtap="onCloseInvite">
      <view class="invite-dialog-content" catchtap="stopPropagation">
        <view class="invite-dialog-header">
          <text class="invite-dialog-title">邀请好友</text>
          <text class="invite-dialog-close" bindtap="onCloseInvite">✕</text>
        </view>
        <view class="invite-dialog-body">
          <view class="invite-code-display">
            <text class="invite-code-label">邀请码</text>
            <view class="invite-code-value">{{inviteCode}}</view>
            <button class="copy-invite-btn" bindtap="onCopyInviteCode">复制邀请码</button>
          </view>
          <view class="invite-tips">
            <text>• 分享房间链接给好友</text>
            <text>• 或让好友输入邀请码加入</text>
          </view>
        </view>
        <view class="invite-dialog-footer">
          <button class="share-btn" open-type="share">分享给好友</button>
        </view>
      </view>
    </view>
  </block>
</view>
