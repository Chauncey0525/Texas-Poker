# Git 工作流程说明

## 分支策略

### main 分支
- **用途**：生产环境代码，稳定版本
- **保护**：只接受来自 `dev` 分支的合并请求
- **操作**：需要代码审查后才能合并

### dev 分支
- **用途**：日常开发分支，用于集成所有功能
- **操作**：从 `feature` 和 `fix` 分支合并代码
- **合并**：开发完成后，通过 Pull Request 合并到 `main` 分支

### feature 分支
- **用途**：新功能开发
- **命名**：`feature/功能名称`（如：`feature/user-login`）
- **来源**：从 `dev` 分支创建
- **合并**：开发完成后合并回 `dev` 分支

### fix 分支
- **用途**：Bug修复
- **命名**：`fix/问题描述`（如：`fix/room-list-loading`）
- **来源**：从 `dev` 分支创建
- **合并**：修复完成后合并回 `dev` 分支

## 日常开发流程

### 1. 开始开发（自动创建分支）

使用辅助脚本自动创建和切换分支：

```bash
# 新功能开发
./git-helper.sh feature 功能名称

# Bug修复
./git-helper.sh fix 问题描述
```

脚本会自动：
- 切换到 dev 分支
- 拉取最新代码
- 创建对应的 feature 或 fix 分支
- 切换到新分支

### 2. 手动创建分支（不使用脚本）

```bash
# 确保在 dev 分支
git checkout dev

# 拉取最新代码
git pull origin dev

# 创建功能分支
git checkout -b feature/功能名称

# 或创建修复分支
git checkout -b fix/问题描述
```

### 3. 开发并提交

#### 方法一：使用自动提交脚本（推荐）

脚本会根据当前分支类型自动选择提交前缀：

```bash
# Linux/Mac
./git-commit.sh

# Windows PowerShell
.\git-commit.ps1
```

脚本会自动：
- 检测当前分支类型（feature/fix/dev）
- 自动添加正确的提交前缀（feat/fix/chore）
- 提示输入提交信息
- 执行提交

#### 方法二：手动提交

```bash
# 添加更改
git add .

# 提交更改（根据分支类型使用不同前缀）
# feature 分支使用 feat:
git commit -m "feat: 功能描述"

# fix 分支使用 fix:
git commit -m "fix: 修复问题描述"

# 推送到远程分支
git push origin feature/功能名称
# 或
git push origin fix/问题描述
```

### 4. 合并到 dev 分支

开发完成后，将 feature/fix 分支合并到 dev：

```bash
# 切换到 dev 分支
git checkout dev

# 拉取最新代码
git pull origin dev

# 合并功能分支
git merge feature/功能名称

# 或合并修复分支
git merge fix/问题描述

# 推送到远程
git push origin dev

# 删除本地分支（可选）
git branch -d feature/功能名称
git branch -d fix/问题描述

# 删除远程分支（可选）
git push origin --delete feature/功能名称
git push origin --delete fix/问题描述
```

### 4. 合并到 main 分支

当功能开发完成并测试通过后：

#### 方法一：通过 GitHub Pull Request（推荐）
1. 在 GitHub 上创建 Pull Request：`dev` → `main`
2. 填写 PR 描述，说明更改内容
3. 等待代码审查
4. 审查通过后合并到 `main`

#### 方法二：本地合并（需要权限）
```bash
# 切换到 main 分支
git checkout main

# 拉取最新代码
git pull origin main

# 合并 dev 分支
git merge dev

# 推送到远程
git push origin main

# 切换回 dev 分支继续开发
git checkout dev
```

## 提交信息规范

使用约定式提交（Conventional Commits）：

- `feat:` - 新功能
- `fix:` - 修复bug
- `docs:` - 文档更新
- `style:` - 代码格式调整（不影响功能）
- `refactor:` - 代码重构
- `test:` - 测试相关
- `chore:` - 构建/工具链相关

示例：
```
feat: 添加用户登录功能
fix: 修复房间列表加载失败的问题
docs: 更新README文档
refactor: 重构游戏状态管理逻辑
```

## 注意事项

1. **不要直接在 main 分支开发**
   - 所有开发都在 `dev` 分支进行
   - `main` 分支只接受来自 `dev` 的合并

2. **定期同步代码**
   ```bash
   # 在 dev 分支
   git pull origin dev
   ```

3. **保持提交信息清晰**
   - 使用有意义的提交信息
   - 一次提交只做一件事

4. **合并前检查**
   - 确保代码可以正常编译
   - 确保没有明显的bug
   - 更新相关文档

## 分支工作流程示例

```
main (生产环境)
  ↑
dev (开发环境)
  ↑
feature/xxx (新功能) 或 fix/xxx (Bug修复)
```

## 当前分支状态

- **当前工作分支**：`dev`
- **主分支**：`main`
- **远程仓库**：`origin`

## 辅助脚本

### git-helper.sh / git-helper.ps1
自动创建和切换 feature/fix 分支

**Linux/Mac:**
```bash
./git-helper.sh feature 功能名称
./git-helper.sh fix 问题描述
```

**Windows:**
```powershell
.\git-helper.ps1 -Type feature -Name 功能名称
.\git-helper.ps1 -Type fix -Name 问题描述
```

### git-commit.sh / git-commit.ps1
根据当前分支类型自动选择提交前缀

**Linux/Mac:**
```bash
./git-commit.sh
```

**Windows:**
```powershell
.\git-commit.ps1
```

## 快速命令参考

```bash
# 查看当前分支
git branch

# 查看所有分支
git branch -a

# 切换到 dev 分支
git checkout dev

# 查看状态
git status

# 查看提交历史
git log --oneline

# 查看 dev 和 main 的差异
git diff main..dev
```
